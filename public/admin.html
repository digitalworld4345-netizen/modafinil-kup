
<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Panel zamówień | Modafinil-kup</title>
<link rel="stylesheet" href="/styles.css">
<link rel="icon" href="/logo.svg">
</head>
<body>
  <div class="container">
    <header class="header">
      <a class="logo" href="/index.html"><img src="/logo.svg" alt="Logo Modafinil-kup" width="36" height="36"><strong>Modafinil-kup</strong></a>
      <nav class="nav"><a href="/index.html">Sklep</a></nav>
      <div class="kicker">admin@Modafinil-kup.de</div>
    </header>

    <div class="card">
      <h1>Panel zamówień</h1>
      <p class="small">Prosty widok wszystkich zamówień. Zmień status i eksportuj do CSV.</p>
      <div style="margin:10px 0;">
        <button class="btn" id="exportBtn">Eksport CSV</button>
      </div>
      <table class="table" id="ordersTable">
        <thead><tr><th>ID</th><th>Data</th><th>Klient</th><th>Telefon</th><th>Adres</th><th>Suma</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
<script>
async function fetchOrders(){
  const res = await fetch('/api/orders');
  const data = await res.json();
  const tbody = document.querySelector('#ordersTable tbody');
  tbody.innerHTML = data.map(o=>{
    const total = o.cart.reduce((s,i)=> s + i.unitPrice * i.count, 0) + (o.shippingFee||0);
    return `<tr>
      <td>${o.id}</td>
      <td>${new Date(o.createdAt).toLocaleString('pl-PL')}</td>
      <td>${o.name}</td>
      <td>${o.phone}</td>
      <td>${o.address}</td>
      <td>${total} zł</td>
      <td>
        <select onchange="updateStatus('${o.id}', this.value)">
          <option ${o.status==='pending'?'selected':''} value="pending">Oczekuje</option>
          <option ${o.status==='shipped'?'selected':''} value="shipped">Wysłane</option>
          <option ${o.status==='delivered'?'selected':''} value="delivered">Dostarczone</option>
        </select>
      </td>
    </tr>`;
  }).join('');
}
async function updateStatus(id, status){
  await fetch('/api/orders/'+id, {method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify({status})});
  fetchOrders();
}
document.getElementById('exportBtn').addEventListener('click', async ()=>{
  const res = await fetch('/api/orders?format=csv');
  const text = await res.text();
  const blob = new Blob([text], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'zamowienia.csv'; a.click();
  URL.revokeObjectURL(url);
});
fetchOrders();
</script>
</body>
</html>
